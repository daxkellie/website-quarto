---
title: "My Listening"
description: |
  What have I been listening to? Let's find out...using plots!
date: "08/30/2021"
categories:
  - Music
  - Data Visualisation
format:
  html:
    highlight: default
    toc: true
    toc_float: true
---

Spotify let's you download your listening history without much fuss. Thanks to some excellent posts like [this one](https://towardsdatascience.com/explore-your-activity-on-spotify-with-r-and-spotifyr-how-to-analyze-and-visualize-your-stream-dee41cb63526) and some really cool packages like [spotifyr](https://github.com/charlie86/spotifyr), it's also easy to learn how to download your Spotify data and make some nice visualisations in R. 

<aside>
If you are keen for a challenge, here is [a post on how to make a beautiful bump chart](https://github-wiki-see.page/m/davidsjoberg/ggbump/wiki/My-year-on-Spotify) that I was too intimidated to try
</aside>

So, I thought I would try it out!


```{r, warning = FALSE, message = FALSE}
# packages
library(jsonlite)
library(lubridate)
library(gghighlight)
library(spotifyr)
library(tidyverse)
library(plotly)
library(viridis)
library(here)
```


```{r, warning = FALSE, message = FALSE, results = FALSE}
# set wd
here::here("mysite", "posts", "2021-07-10_spotify_analysis", "index.qmd")
```


```{r, warning = FALSE, message = FALSE}
# Importing data

# Import the stream data from Spotify which are in JSON-format.
# Create a month variable by flooring the stream date column.
df <- bind_rows(
  as_tibble(fromJSON("private_data/MyData/StreamingHistory0.json")),
  as_tibble(fromJSON("private_data/MyData/StreamingHistory1.json")),
  as_tibble(fromJSON("private_data/MyData/StreamingHistory2.json"))
) %>% 
  mutate_at("endTime", ymd_hm) %>% 
  mutate(endTime = endTime + hours(10)) %>% 
  mutate(date = floor_date(endTime, "day") %>% 
           as_date, seconds = msPlayed / 1000, minutes = seconds / 60)
```


# Hours of listening per week

```{r, code_folding = TRUE}
# Playback activity per week & hours

streamingHours <- df %>% 
  group_by(date) %>% 
  group_by(date = floor_date(date, "week")) %>%
  summarise(hours = sum(minutes) / 60) %>% 
  arrange(date) %>%
  
  ggplot(aes(x = date, y = hours)) + 
  geom_col(aes(fill = hours), alpha = 0.9) +
  scale_fill_viridis(option = "D", direction = -1) + 
  labs(x= "Date", y= "Hours of music playback") + 
  ggtitle("My weekly listening on Spotify (Jul 2020 - Jul 2021)") + 
  theme_minimal()

ggplotly(streamingHours)
```

***

# Artists I listen to most

```{r, code_folding = TRUE}
minutesMostListened <- df %>% 
  group_by(artistName) %>% 
  summarise(hoursListened = ((sum(minutes)) / 60) %>% round(., 2)) %>% 
  filter(hoursListened >= 5) %>%
  
  ggplot(aes(x = reorder(artistName, hoursListened), y = hoursListened)) + 
  geom_col(aes(fill = hoursListened)) +
  scale_fill_viridis(option = "G", direction = -1) + 
  labs(x= "Artist", y= "Hours of music playback") + 
  ggtitle("Artists I listened to most (Jul 2020 - Jul 2021)", 
          subtitle = "> 5 hours listened") +
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip()

minutesMostListened
```

<br>

```{r, eval = FALSE, echo = FALSE, warning = FALSE, message = FALSE}
# To do this yourself you need to get the following:
library(spotifyr)
Sys.setenv(SPOTIFY_CLIENT_ID = 'your-id-number')
Sys.setenv(SPOTIFY_CLIENT_SECRET = 'your-secret-number')

access_token <- get_spotify_access_token()
```


```{r, code_folding = TRUE, eval = FALSE}
library(tidyverse)
library(lubridate)
library(kableExtra)

get_my_top_artists_or_tracks(type = 'artists', 
                             time_range = 'long_term', 
                             limit = 10) %>% 
  select(.data$name, .data$genres) %>% 
  rowwise %>% 
  mutate(genres = paste(.data$genres, collapse = ', ')) %>% 
  ungroup %>% 
  kbl() %>% 
  kable_styling() %>%
  add_header_above(c("Top 10 Artists of All Time" = 2))
```

***

# When do I listen to music?

```{r, code_folding = TRUE, eval = FALSE}
# When am I listening to music?
hoursDay <- df %>% 
  mutate(
    hour = hour(endTime),
    weekday = wday(date, label = TRUE)
  ) %>%
  group_by(hour, weekday) %>% 
  summarise(minutesListened = sum(minutes))
  
hoursDay %>% 
  ggplot(aes(x = hour, y = minutesListened)) + 
  stat_summary(fun = "mean", geom = "bar", fill = "#4698c5") +
  labs(x = "Time of day", y = "Minutes of music playback") + 
  ggtitle("Time of day I listened to music", 
          "From 0 to 24 hours") + 
  theme_minimal()
```

